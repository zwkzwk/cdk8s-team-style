
# 测试内容

## 内网穿透软件

- 全傻瓜需求：花生壳（有免费）

```
- 下载软件：<https://hsk.oray.com/>
- 官网帮助文档：<https://service.oray.com/question/10541.html>
- 下一步下一步安装
- 打开软件，微信扫码登录
- 点击右下角加号 "添加映射"，会跳转到花生壳官网
- 选择：【用户中心】--【花生壳管理】--【点击对应帐号】--【域名列表】
- 需要花费 6 块进行购买穿透服务，而且还要下载他们 APP 进行实名认证。这些挺坑的，其他就还好。
```


- 半傻瓜需求：natapp（有免费）

```
- 官网帮助文档：<https://natapp.cn/article/natapp_newbie>
- 官网注册账号
- 登录，点击左上角：购买免费隧道
- 填写映射的本地端口后会给你生成一个 authtoken
- Windows 系统
    - 修改 config.ini，填写 authtoken
    - 双击 natapp.exe 即可
- Linux、macOS
     - 赋权：chmod a+x natapp
     - 执行：./natapp -authtoken=9ab6b9040a624f40
- 执行成功会告诉你一个临时的免费域名，这个域名是动态的，每次启动都会变，所以相对比较麻烦。
```

- 全配置需求：frp
- 一般都要下载花生壳、natapp，它们都是有崩过的经历，所以别在关键时候掉链子了

## 测试流程

- 测试用例
- 测试数据
- 测试脚本
- 执行测试
- 测试报告
- 问题跟踪
- 数据库
    - 清洗隐私数据（密码、身份证、手机号、邮箱地址、居住地址）
    - 数据同步规则、同步周期

## 细节考虑

- 移动端设备电量、网络有限
- 注意电量、流量在各个业务场景下的使用情况

## 单元测试

- 业务主流程必写
- 出现 Bug 的流程必须补充

## Mock 测试

- YApi
- [Mock 手册](../dev/common/mock.md)

## UI 自动化测试

- 业务主流程必写
- 出现 Bug 的流程必须补充

## 接口自动化测试

- 业务主流程必写
- 核心模块必写
- 出现 Bug 的流程必须补充

## 压力测试

- 业务主流程必写
- 核心模块必写
- 出现 Bug 的流程必须补充
- 秒杀、促销必须压力测试
- 新架构基准测试


## 接口压力测试

- 业务 API 接口：95% Line 控制在 2 秒以内
- 底层 API 接口：95% Line 控制在 300 毫秒以内
- JVM 异常监控
    - VisualVM
    - JProfile

## 容量规划

- 长期容量规划
- 短期容量规划


## 安全

- 硬件
    - 开启云盘备份：利用自动快照策略定期针对云盘进行备份，以应对病毒感染、数据误删等风险。（有费用支出）
    - 采用 SSH 密码对登录机制，由公钥和私钥组成，客户端使用 SSH 密钥才能登录 ECS 服务器
    - 安全组设置白名单访问规则，只允许特定运营人员机子连上服务器，并且只能连接特定端口。
    - 开启网络隔离模式
        - 设置内网地址白名单，只有指定的 ECS 可以访问
        - 设置外网地址白名单，只有指定的客户端 IP 可以访问
    - 设置报警规则，当CPU使用率、磁盘空间使用率、IOPS使用率、连接数使用率有异常情况及时通知相关人员，通过：短信+邮件+钉钉机器人等方式
    - RDS MySQL 默认开启了备份功能，支持多样的自动备份策略。本地盘实例支持长期保留备份文件，并且可以设置删除实例后继续保留备份文件，避免了误操作导致的数据丢失
- 软件
    - 全站 HTTPS，如果网页是 HTTPS 则接口也必须是 HTTPS 不然会无法请求
    - 视频加密 VOD
    - ID 雪花算法
    - 获取当前用户信息只能通过 token，不能让前端传当前用户 ID 值
    - 线上交易的所有操作都要记录用户 IP、UserAgent
    - 短信、邮件等会扣费的服务，要限定单次发送间隔，每天同一个号码限量数
    - SQL 注入，框架需要支持，以及客户端请求参数与最终数据库执行参数分开
    - CSRF 跨站请求伪造
    - XSS 跨站脚本，框架需要支持，特别是富文本一定需要做测试
    - 文件上传漏洞，需要在上传接口上写 log，记录用户 IP、UserAgent、文件名称、文件大小
    - 客户认为特别重要的数据必须先加密后落库存储
    - 密码加盐再加密需求
    - 密码等重要信息不能响应给前端
    - 对称加密（AES） + base64
    - 非对称加密（RSA） + 签名和验签方式
        - 请求参数
        - 按照第一个字符的键值 ASCII 码递增排序（字母升序排序），如果遇到相同字符则按照第二个字符的键值 ASCII 码递增排序，以此类推。
        - 将排序后的参数与其对应值，组合成 “参数=参数值” 的格式，并且把这些参数用 & 字符连接起来，此时生成的字符串 **为待签名字符串**，类似格式：`aa=11&bb=22&cc=33`
        - 签名：安全BASE64(SHA256WithRSA(代签名字符串 + 私钥))

## 性能

- 硬件
    - 升级带宽
    - 使用 SSD 硬盘
- 前端
    - 前端页面加载资源时间跟踪
    - 前端资源合并、压缩：HTML、CSS、JS
    - 前端图片预加载
    - 对DNS预获取
    - 样式放头部，脚本放底部
- 后端
    - 记录 SQL 执行时间
    - 记录方法执行时间
    - SQL 优化
    - 无状态设计，不采用 session 机制
    - 执行时间过长的方法需要上 Redis 等中间件缓存
    - 用户不需要立即知道响应结果的接口可以用多线程异步处理
    - 静态分离，静态资源托管到 OSS
    - 图片转换为 WebP 格式
    - 禁止没有缓存清空下循环、递归查询数据库
    - 一些临时的 key/value 结构数据可以存在 Redis 中
- 部署
    - 部署 CDN
    - 应用多节点部署
    - Nginx 配置 Etag 和 Expires 缓存配置
    - Nginx 开启 Gzip 压缩
- 监控
    - Prometheus + Grafana
    - GoAccess
    - Skywalking
    - 阿里云 ARMS 前端监控
        - 页面访问速度：首次渲染时间、首屏时间、DOM Ready 时间、资源加载时间等
        - API 请求监控：调用成功率、返回信息、平均耗时
        - JS 错误诊断：类似 Sentry












